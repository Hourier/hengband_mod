## Makefile.am -- Process this file with automake to process Makefile.in

AUTOMAKE_OPTIONS = foreign subdir-objects nostdinc

bin_PROGRAMS = hengband

hengband_SOURCES = \
	artifact.c artifact.h \
	\
	angband.h\
	\
	autopick/autopick.c autopick/autopick.h \
	autopick/autopick-commands-table.h autopick/autopick-dirty-flags.h \
	autopick/autopick-editor-table.h autopick/autopick-flags-table.h \
	autopick/autopick-key-flag-process.h autopick/autopick-keys-table.h \
	autopick/autopick-menu-data-table.c autopick/autopick-menu-data-table.h \
	autopick/autopick-methods-table.h \
	autopick/autopick-util.c autopick/autopick-util.h \
	autopick/autopick-entry.c autopick/autopick-entry.h \
	autopick/autopick-initializer.c autopick/autopick-initializer.h \
	autopick/autopick-matcher.c autopick/autopick-matcher.h \
	autopick/autopick-describer.c autopick/autopick-describer.h \
	autopick/autopick-destroyer.c autopick/autopick-destroyer.h \
	autopick/autopick-reader-writer.c autopick/autopick-reader-writer.h \
	autopick/autopick-finder.c autopick/autopick-finder.h \
	autopick/autopick-pref-processor.c autopick/autopick-pref-processor.h \
	autopick/autopick-drawer.c autopick/autopick-drawer.h \
	autopick/autopick-inserter-killer.c autopick/autopick-inserter-killer.h \
	autopick/autopick-registry.c autopick/autopick-registry.h \
	autopick/autopick-command-menu.c autopick/autopick-command-menu.h \
	autopick/autopick-editor-util.c autopick/autopick-editor-util.h \
	autopick/autopick-editor-command.c autopick/autopick-editor-command.h \
	\
	avatar.h avatar.c \
	\
	birth/birth-explanations-table.c birth/birth-explanations-table.h \
	birth/birth.c birth/birth.h \
	\
	main/music-definitions-table.c main/music-definitions-table.h \
	main/sound-definitions-table.c main/sound-definitions-table.h \
	market/arena-info-table.c market/arena-info-table.h \
	market/building.c market/building.h \
	market/building-util.c market/building-util.h \
	market/play-gamble.c market/play-gamble.h \
	market/poker.c market/poker.h market/store-owners.c market/store-owners.h \
	market/store-owner-comments.c market/store-owner-comments.h \
	market/articles-on-sale.c market/articles-on-sale.h \
	market/black-market.c market/black-market.h \
	market/say-comments.c market/say-comments.h \
	market/store-util.c market/store-util.h \
	market/gold-magnification-table.c market/gold-magnification-table.h \
	market/store.c market/store.h \
	chest.c chest.h chuukei.c chuukei.h \
	\
	view/display-characteristic.c view/display-characteristic.h \
	view/display-fruit.c view/display-fruit.h \
	view/display-main-window.c view/display-main-window.h \
	view/display-player-stat-info.c view/display-player-stat-info.h \
	view/display-player-misc-info.c view/display-player-misc-info.h \
	view/display-player-middle.c view/display-player-middle.h \
	view/display-player.c view/display-player.h \
	view/status-first-page.c view/status-first-page.h \
	view/display-util.c view/display-util.h \
	\
	player/mimic-info-table.c player/mimic-info-table.h \
	player/process-death.c player/process-death.h \
	player/process-name.c player/process-name.h \
	player/race-info-table.c player/race-info-table.h\
	player/race-resistances.c player/race-resistances.h \
	player/permanent-resistances.c player/permanent-resistances.h \
	player/temporary-resistances.c player/temporary-resistances.h \
	player/digestion-processor.c player/digestion-processor.h \
	\
	io/dump-remover.c io/dump-remover.h \
	io/gf-descriptions.c io/gf-descriptions.h \
	io/tokenizer.c io/tokenizer.h \
	io/interpret-pref-file.c io/interpret-pref-file.h \
	io/player-status-dump.c io/player-status-dump.h \
	io/special-class-dump.c io/special-class-dump.h \
	io/read-pref-file.c io/read-pref-file.h \
	io/exit-panic.c io/exit-panic.h \
	io/write-diary.c io/write-diary.h \
	io/mutations-dump.c io/mutations-dump.h \
	io/signal-handlers.c io/signal-handlers.h \
	io/uid-checker.c io/uid-checker.h \
	io/input-key-processor.c io/input-key-processor.h \
	\
	character-dump.c character-dump.h files.c files.h \
	core/system-variables.c core/system-variables.h \
	core/game-play.c core/game-play.h \
	core/show-file.c core/show-file.h \
	core/stuff-handler.c core/stuff-handler.h \
	core/angband-version.h core/special-internal-keys.h \
	core/output-updater.c core/output-updater.h \
	core/game-closer.c core/game-closer.h \
	core/turn-compensator.c core/turn-compensator.h \
	core/hp-mp-regenerator.c core/hp-mp-regenerator.h \
	core/hp-mp-processor.c core/hp-mp-processor.h \
	core/magic-effects-timeout-reducer.c core/magic-effects-timeout-reducer.h \
	core/player-processor.c core/player-processor.h \
	\
	dungeon/dungeon.c dungeon/dungeon.h \
	dungeon/dungeon-processor.c dungeon/dungeon-processor.h \
	dungeon/dungeon-file.c dungeon/dungeon-file.h \
	\
	floor.c floor.h floor-events.c floor-events.h \
	floor-generate.c floor-generate.h \
	floor-save.h floor-save.c floor-town.h floor-town.c \
	floor-streams.c floor-streams.h \
	floor/pattern-walk.c floor/pattern-walk.h \
	\
	feature.c feature.h \
	geometry.c geometry.h \
	\
	gamevalue.h \
	grid.c grid.h h-basic.h h-config.h h-define.h \
	history.h history.c \
	h-system.h h-type.h inet.c inet.h init.c init.h \
	japanese.c japanese.h english.c english.h \
	load.c load.h \
	main.c main-x11.c main-gcu.c \
	mind.c mind.h \
	\
	monster.h monsterrace.c monsterrace.h \
	monster/monster-util.c monster/monster-util.h \
	monster/monster-direction.c monster/monster-direction.h \
	monster/monster-attack.c monster/monster-attack.h \
	monster/monster-move.c monster/monster-move.h \
	monster/monster-object.c monster/monster-object.h \
	monster/monster-runaway.c monster/monster-runaway.h \
	monster/monster-safety-hiding.c monster/monster-safety-hiding.h \
	monster/monster-sweep-grid.c monster/monster-sweep-grid.h \
	monster/monster-update.c monster/monster-update.h \
	monster/quantum-effect.c monster/quantum-effect.h \
	monsterrace-hook.c monsterrace-hook.h \
	monster-dist-offsets.c monster-dist-offsets.h \
	monster-process.c monster-process.h \
	monster-status.c monster-status.h monster1.c monster2.c \
	mspells1.c mspells2.c mspells3.c mspells4.c monster-spell.h \
	\
	mutation/mutation.c mutation/mutation.h \
	mutation/mutation-processor.c mutation/mutation-processor.h \
	\
	object-boost.c object-boost.h \
	object-curse.c object-curse.h object-broken.c object-broken.h \
	object-hook.c object-hook.h object1.c object2.c object.h \
	object/object-kind.c object/object-kind.h \
	object/object-kind-hook.c object/object-kind-hook.h \
	object/lite-processor.c object/lite-processor.h \
	object-flavor.c object-flavor.h object-ego.c object-ego.h \
	\
	inventory/simple-appraiser.c inventory/simple-appraiser.h \
	inventory/inventory-curse.c inventory/inventory-curse.h \
	inventory/recharge-processor.c inventory/recharge-processor.h \
	inventory/pack-overflow.c inventory/pack-overflow.h \
	\
	patron.h patron.c \
	\
	creature.h creature.c \
	player-move.c player-move.h player-damage.c player-damage.h \
	horror-descriptions.c horror-descriptions.h \
	player-status.c player-status.h player-effects.c player-effects.h \
	player-skill.c player-skill.h player-class.c player-class.h \
	player-race.c player-race.h player-personality.c player-personality.h \
	player-sex.c player-sex.h player-inventory.c player-inventory.h \
	\
	quest.h quest.c\
	\
	racial.c racial.h \
	realm/realm.c realm/realm.h \
	realm/realm-arcane.c realm/realm-arcane.h \
	realm/realm-chaos.c realm/realm-chaos.h \
	realm/realm-craft.c realm/realm-craft.h \
	realm/realm-crusade.c realm/realm-crusade.h \
	realm/realm-daemon.c realm/realm-daemon.h \
	realm/realm-death.c realm/realm-death.h \
	realm/realm-hex.c realm/realm-hex.h \
	realm/realm-hissatsu.c realm/realm-hissatsu.h \
	realm/realm-life.c realm/realm-life.h \
	realm/realm-nature.c realm/realm-nature.h realm/realm-song.c \
	realm/realm-song.h realm/realm-sorcery.c \
	realm/realm-sorcery.h realm/realm-trump.c realm/realm-trump.h \
	\
	report.c report.h \
	rooms.c rooms-city.c rooms-city.h rooms-fractal.c rooms-fractal.h \
	rooms.h rooms-normal.c rooms-normal.h \
	rooms-special.c rooms-special.h rooms-trap.c rooms-trap.h \
	rooms-vault.c rooms-vault.h \
	room/rooms-pit-nest.c room/rooms-pit-nest.h \
	room/pit-nest-kinds-table.c room/pit-nest-kinds-table.h \
	save.c save.h scores.c scores.h selfinfo.c selfinfo.h \
	snipe.c snipe.h \
	\
	rumor.h rumor.c \
	\
	effect/effect-feature.c effect/effect-feature.h \
	effect/effect-item.c effect/effect-item.h \
	effect/spells-effect-util.c effect/spells-effect-util.h \
	effect/effect-player.c effect/effect-player.h \
	effect/effect-monster.c effect/effect-monster.h \
	effect/effect-monster-util.c effect/effect-monster-util.h \
	effect/effect-monster-resist-hurt.c effect/effect-monster-resist-hurt.h \
	effect/effect-monster-psi.c effect/effect-monster-psi.h \
	effect/effect-monster-domination.c effect/effect-monster-domination.h \
	effect/effect-monster-oldies.c effect/effect-monster-oldies.h \
	effect/effect-monster-charm.c effect/effect-monster-charm.h \
	effect/effect-monster-curse.c effect/effect-monster-curse.h \
	effect/effect-monster-lite-dark.c effect/effect-monster-lite-dark.h \
	effect/effect-monster-evil.c effect/effect-monster-evil.h \
	effect/effect-monster-spirit.c effect/effect-monster-spirit.h \
	effect/effect-monster-switcher.c effect/effect-monster-switcher.h \
	effect/effect-player-util.h \
	effect/effect-player-resist-hurt.c effect/effect-player-resist-hurt.h \
	effect/effect-player-oldies.c effect/effect-player-oldies.h \
	effect/effect-player-curse.c effect/effect-player-curse.h \
	effect/effect-player-spirit.c effect/effect-player-spirit.h \
	effect/effect-player-switcher.c effect/effect-player-switcher.h \
	effect/effect-characteristics.h \
	\
	spell/technic-info-table.c spell/technic-info-table.h \
	spell/spells-execution.c spell/spells-execution.h \
	spell/spells-util.h spell/spells-type.h \
	spell/process-effect.c spell/process-effect.h \
	spell/spells1.c spell/spells1.h spell/spells2.c spell/spells2.h \
	spell/spells3.c spell/spells3.h \
	spell/music-checker.c spell/music-checker.h \
	spells-diceroll.c spells-diceroll.h \
	spells-floor.c spells-floor.h \
	spells-object.c spells-object.h \
	spells-status.c spells-status.h \
	spells-summon.c spells-summon.h \
	spells-world.c spells-world.h \
	\
	sort.c sort.h gameterm.c gameterm.h trap.c trap.h util.c util.h \
	wild.h wild.c warning.c warning.h \
	\
	targeting.c targeting.h \
	\
	z-form.c z-form.h z-rand.c z-rand.h z-term.c z-term.h z-util.c z-util.h \
	z-virt.c z-virt.h \
	\
	knowledge/knowledge-autopick.c knowledge/knowledge-autopick.h \
	knowledge/knowledge-experiences.c knowledge/knowledge-experiences.h \
	knowledge/knowledge-features.c knowledge/knowledge-features.h \
	knowledge/knowledge-inventory.c knowledge/knowledge-inventory.h \
	knowledge/knowledge-items.c knowledge/knowledge-items.h \
	knowledge/knowledge-monsters.c knowledge/knowledge-monsters.h \
	knowledge/knowledge-mutations.c knowledge/knowledge-mutations.h \
	knowledge/knowledge-uniques.c knowledge/knowledge-uniques.h \
	knowledge/knowledge-self.c knowledge/knowledge-self.h \
	knowledge/knowledge-quests.c knowledge/knowledge-quests.h \
	\
	cmd/cmd-autopick.c cmd/cmd-autopick.h \
	cmd/dump-util.c cmd/dump-util.h cmd/feeling-table.c cmd/feeling-table.h \
	cmd/monster-group-table.c cmd/monster-group-table.h \
	cmd/diary-subtitle-table.c cmd/diary-subtitle-table.h \
	cmd/object-group-table.c cmd/object-group-table.h \
	cmd/cmd-activate.c cmd/cmd-activate.h cmd/cmd-basic.c cmd/cmd-basic.h \
	cmd/cmd-diary.c cmd/cmd-diary.h cmd/cmd-dump.c cmd/cmd-dump.h \
	cmd/cmd-draw.c cmd/cmd-draw.h cmd/cmd-eat.c cmd/cmd-eat.h \
	cmd/cmd-gameoption.c cmd/cmd-gameoption.h cmd/cmd-help.c cmd/cmd-help.h \
	cmd/cmd-hissatsu.c cmd/cmd-hissatsu.h cmd/cmd-inn.c cmd/cmd-inn.h \
	cmd/cmd-item.c cmd/cmd-item.h cmd/cmd-knowledge.c cmd/cmd-knowledge.h \
	cmd/lighting-level-table.c cmd/lighting-level-table.h \
	cmd/cmd-magiceat.c cmd/cmd-magiceat.h cmd/cmd-mane.c cmd/cmd-mane.h \
	cmd/cmd-macro.c cmd/cmd-macro.h cmd/cmd-pet.c cmd/cmd-pet.h \
	cmd/cmd-quaff.c cmd/cmd-quaff.h cmd/cmd-read.c cmd/cmd-read.h \
	cmd/cmd-process-screen.c cmd/cmd-process-screen.h \
	cmd/cmd-save.c cmd/cmd-save.h cmd/cmd-smith.c cmd/cmd-smith.h \
	cmd/cmd-spell.c cmd/cmd-spell.h cmd/cmd-visuals.c cmd/cmd-visuals.h \
	cmd/cmd-usestaff.c cmd/cmd-usestaff.h \
	cmd/cmd-zaprod.c cmd/cmd-zaprod.h cmd/cmd-zapwand.c cmd/cmd-zapwand.h \
	\
	combat/melee.h combat/melee.c combat/shoot.c combat/shoot.h \
	\
	wizard/wizard-spoiler.c wizard/wizard-spoiler.h\
	wizard/wizard-special-process.c wizard/wizard-special-process.h \
	\
	world/world.c world/world.h \
	world/world-movement-processor.c world/world-movement-processor.h \
	world/world-turn-processor.c world/world-turn-processor.h

EXTRA_hengband_SOURCES = \
	angband.ico angband.rc ang_eng.rc maid-x11.c main-win.c \
	main-cap.c main-xaw.c \
	makefile.bcc makefile.std readdib.c readdib.h wall.bmp 

cocoa_xcode_files = \
	cocoa/AppDelegate.m \
	cocoa/Base.lproj/MainMenu.xib
cocoa_icon_files = \
	cocoa/hengband_Icons.icns \
	cocoa/Save.icns \
	cocoa/Edit.icns \
	cocoa/Data.icns
cocoa_plist_template = cocoa/Angband-Cocoa.xml
cocoa_plist_strings_template = cocoa/Angband-Cocoa.strings
cocoa_plist_files = \
	cocoa/CommandMenu.plist
cocoa_en_nib_files = \
	cocoa/Base.lproj/MainMenu.nib
cocoa_en_strings_files = \
	cocoa/en.lproj/Localizable.strings \
	cocoa/en.lproj/CommandMenu.strings \
	cocoa/en.lproj/GraphicsMenu.strings
cocoa_ja_strings_files = \
	cocoa/ja.lproj/MainMenu.strings \
	cocoa/ja.lproj/Localizable.strings \
	cocoa/ja.lproj/CommandMenu.strings \
	cocoa/ja.lproj/GraphicsMenu.strings

EXTRA_DIST = \
	gcc-wrap \
	$(cocoa_xcode_files) \
	$(cocoa_icon_files) \
	$(cocoa_plist_template) \
	$(cocoa_plist_strings_template) \
	$(cocoa_plist_files) \
	$(cocoa_en_nib_files) \
	$(cocoa_en_strings_files) \
	$(cocoa_ja_strings_files)

if COCOA
hengband_SOURCES += main-cocoa.m grafmode.h grafmode.c cocoa/AppDelegate.h
AM_CFLAGS = -mmacosx-version-min=10.8 -Wunguarded-availability
AM_OBJCFLAGS = -fobjc-arc -mmacosx-version-min=10.8 -Wunguarded-availability
hengband_LDFLAGS = -framework cocoa $(AM_LDFLAGS)
hengband_LINK = MACOSX_DEPLOYMENT_TARGET=10.8 $(OBJCLINK) $(hengband_LDFLAGS) $(LDFLAGS) -o $@
APPNAME = $(PACKAGE_NAME)
APPEXE = hengband
APPDIR = $(APPNAME).app
BUNDLE_IDENTIFIER = jp.osdn.hengband
BUNDLE_VERSION = $(PACKAGE_VERSION)
BUNDLE_DISPLAY_NAME = $(APPNAME)
BUNDLE_NAME = $(BUNDLE_DISPLAY_NAME)
BUNDLE_DISPLAY_NAME_JA = 変愚蛮怒
BUNDLE_NAME_JA = $(BUNDLE_DISPLAY_NAME_JA)
# Be careful with characters (like '&') in the copyright that have special
# meanings to sed.
COPYRIGHT = Copyright © Mr. Hoge and many others
# For now, using the line that appears in news_j.txt.  Is that appropriate?
# The ampersand is a kanji so it doesn't seem to be treated as a special
# character by sed.
COPYRIGHT_JA = Mr.hoge (echizen＠users.sourceforge.jp) ＆ 多くの方々
APPBNDL = $(bindir)/$(APPDIR)
APPCONT = $(APPBNDL)/Contents
APPBIN = $(APPCONT)/MacOS
APPRES = $(APPCONT)/Resources
appbin_PROGRAMS = $(APPEXE)
appbindir = $(APPBIN)
dist_appicon_DATA = $(cocoa_icon_files)
appicondir = $(APPRES)
appplist_DATA = $(cocoa_plist_files)
appplistdir = $(APPRES)
appennib_DATA = $(cocoa_en_nib_files)
appennibdir = $(APPRES)/Base.lproj
appen_DATA = $(cocoa_en_strings_files)
appendir = $(APPRES)/en.lproj
appja_DATA = $(cocoa_ja_strings_files)
appjadir = $(APPRES)/ja.lproj
else
EXTRA_hengband_SOURCES += main-cocoa.m grafmode.h grafmode.c \
	cocoa/AppDelegate.h
hengband_LINK = $(LINK)
endif

DEFAULT_INCLUDES = -I$(srcdir) \
	-I$(srcdir)/autopick \
	-I$(srcdir)/birth \
	-I$(srcdir)/cmd \
	-I$(srcdir)/combat \
	-I$(srcdir)/core \
	-I$(srcdir)/dungeon \
	-I$(srcdir)/effect \
	-I$(srcdir)/floor \
	-I$(srcdir)/inventory \
	-I$(srcdir)/io \
	-I$(srcdir)/knowledge \
	-I$(srcdir)/market \
	-I$(srcdir)/monster \
	-I$(srcdir)/object \
	-I$(srcdir)/player \
	-I$(srcdir)/realm \
	-I$(srcdir)/room \
	-I$(srcdir)/spell \
	-I$(srcdir)/view \
	-I$(srcdir)/wizard \
	-I$(srcdir)/world \
	-I$(top_builddir)/src
CFLAGS += $(XFT_CFLAGS)
LIBS += $(XFT_LIBS)
COMPILE = $(srcdir)/gcc-wrap $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
OBJCCOMPILE = $(srcdir)/gcc-wrap $(OBJC) $(DEFS) $(DEFAULT_INCLUDES) \
	$(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_OBJCFLAGS) $(OBJCFLAGS)

install-exec-hook:
if SET_GID
	chgrp "@GAMEGROUP@" "$(DESTDIR)$(bindir)/hengband"
	chmod g+s "$(DESTDIR)$(bindir)/hengband"
endif

if COCOA
# Suppress the warnings from the EUC-JP encoded strings used when building
# the Japanese version.
AM_CFLAGS += -Wno-invalid-source-encoding
AM_OBJCFLAGS += -Wno-invalid-source-encoding

# Create lib/info within the application bundle since not currently
# installing anything to it.  Other relevant lib directories should
# be created from the Makefiles in the lib directory.
install-data-local:
	@mkdir -p $(APPCONT)
	@mkdir -p $(appendir)
	@mkdir -p $(appjadir)
	@mkdir -p $(APPRES)/lib/info
	sed -e 's/\$$VERSION\$$/$(PACKAGE_VERSION)/' \
		-e 's/\$$COPYRIGHT\$$/$(COPYRIGHT)/' \
		-e 's/\$$NAME\$$/$(APPNAME)/' \
		-e 's/\$$EXECUTABLE\$$/$(APPEXE)/' \
		-e 's/\$$BUNDLE_VERSION\$$/$(BUNDLE_VERSION)/' \
		-e 's/\$$BUNDLE_IDENTIFIER\$$/$(BUNDLE_IDENTIFIER)/' \
		-e 's/\$$BUNDLE_DISPLAY_NAME\$$/$(BUNDLE_DISPLAY_NAME)/' \
		-e 's/\$$BUNDLE_NAME\$$/$(BUNDLE_NAME)/' \
		$(srcdir)/$(cocoa_plist_template) > $(APPCONT)/Info.plist
	sed -e 's/\$$VERSION\$$/$(PACKAGE_VERSION)/' \
		-e 's/\$$COPYRIGHT\$$/$(COPYRIGHT)/' \
		-e 's/\$$BUNDLE_DISPLAY_NAME\$$/$(BUNDLE_DISPLAY_NAME)/' \
		-e 's/\$$BUNDLE_NAME\$$/$(BUNDLE_NAME)/' \
		$(srcdir)/$(cocoa_plist_strings_template) > $(appendir)/InfoPlist.strings
	sed -e 's/\$$VERSION\$$/$(PACKAGE_VERSION)/' \
		-e 's/\$$COPYRIGHT\$$/$(COPYRIGHT_JA)/' \
		-e 's/\$$BUNDLE_DISPLAY_NAME\$$/$(BUNDLE_DISPLAY_NAME_JA)/' \
		-e 's/\$$BUNDLE_NAME\$$/$(BUNDLE_NAME_JA)/' \
		$(srcdir)/$(cocoa_plist_strings_template) > $(appjadir)/InfoPlist.strings

distclean-local:
	-rm $(APPCONT)/Info.plist
	-rm $(appendir)/InfoPlist.strings
	-rm $(appjadir)/InfoPlist.strings

endif
